<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Horas Complementares - UFBA (v2)</title>
    <!-- Mantive todo o CSS original -->
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh;padding:20px}
        .container{max-width:1200px;margin:0 auto;background:rgba(255,255,255,.95);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}
        header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:30px;text-align:center}
        h1{font-size:2.5em;margin-bottom:10px;font-weight:300}.subtitle{font-size:1.1em;opacity:.9}
        .main-content{display:grid;grid-template-columns:1fr 1fr;gap:30px;padding:30px}
        .form-section{background:#f8f9ff;padding:25px;border-radius:15px;border-left:5px solid #a8b5ff}
        .results-section{background:#fff5f5;padding:25px;border-radius:15px;border-left:5px solid #ffb3b3}
        h2{color:#5a6acf;margin-bottom:20px;font-size:1.5em}
        .form-group{margin-bottom:20px}
        label{display:block;margin-bottom:8px;color:#4a5568;font-weight:500}
        input,select,textarea{width:100%;padding:12px 15px;border:2px solid #e2e8f0;border-radius:10px;font-size:16px;transition:border-color .3s ease;background:#fff}
        input:focus,select:focus,textarea:focus{outline:none;border-color:#a8b5ff;box-shadow:0 0 0 3px rgba(168,181,255,.1)}
        button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;padding:12px 30px;border-radius:25px;font-size:16px;cursor:pointer;transition:transform .2s ease;margin-right:10px}
        button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.4)}
        .activity-item{background:#fff;padding:15px;margin:10px 0;border-radius:10px;border-left:4px solid #a8b5ff;box-shadow:0 2px 10px rgba(0,0,0,.05)}
        .activity-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .activity-title{font-weight:600;color:#2d3748;flex-grow:1}
        .hours-badge{background:#a8b5ff;color:#fff;padding:4px 12px;border-radius:15px;font-size:.85em;font-weight:500}
        .remove-btn{background:#ff6b6b;padding:5px 10px;font-size:12px;margin-left:10px}
        .progress-section{margin-top:30px;padding:20px;background:#f0fff4;border-radius:15px;border-left:5px solid #68d391}
        .progress-bar{background:#e2e8f0;height:20px;border-radius:10px;overflow:hidden;margin:10px 0}
        .progress-fill{height:100%;background:linear-gradient(90deg,#68d391 0%,#38b2ac 100%);transition:width .3s ease;border-radius:10px}
        .category-progress{margin:15px 0}
        .category-name{font-weight:600;color:#2d3748;margin-bottom:5px}
        .suggestions{background:#fffbeb;padding:20px;border-radius:15px;border-left:5px solid #f6ad55;margin-top:20px}
        .suggestion-item{padding:10px;margin:8px 0;background:#fff;border-radius:8px;border-left:3px solid #f6ad55}
        @media(max-width:768px){.main-content{grid-template-columns:1fr}h1{font-size:2em}}
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Sistema de Horas Complementares</h1>
        <p class="subtitle">Ci√™ncia da Computa√ß√£o ‚Äì UFBA</p>
    </header>

    <div class="main-content">
        <div class="form-section">
            <h2>üìù Adicionar Atividade</h2>
            <form id="activityForm">
                <div class="form-group">
                    <label for="activityType">Tipo de Atividade:</label>
                    <select id="activityType" required>
                        <option value="">Selecione uma atividade‚Ä¶</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="hours">Horas Realizadas:</label>
                    <input type="number" id="hours" min="1" required>
                </div>
                <div class="form-group">
                    <label for="description">Descri√ß√£o (opcional):</label>
                    <textarea id="description" rows="3" placeholder="Descreva brevemente a atividade‚Ä¶"></textarea>
                </div>
                <button type="submit">Adicionar Atividade</button>
                <button type="button" onclick="clearAll()">Limpar Tudo</button>
            </form>
        </div>
        <div class="results-section">
            <h2>üìä Suas Atividades</h2>
            <div id="activities"></div>
            <div class="suggestions" id="suggestions" style="display:none;">
                <h3>üí° Sugest√µes de Aproveitamento</h3>
                <div id="suggestionsList"></div>
            </div>
        </div>
    </div>

    <div class="progress-section">
        <h2>üìà Progresso das Horas Complementares</h2>
        <div id="progressBars"></div>
    </div>
</div>

<script>
/**********************  DADOS **********************/
// üîÑ Atualizado: agora cada atividade pode ter categorias alternativas
const atividades = {
    /* ‚Ä¶ (todas as defini√ß√µes anteriores permanecem iguais) ‚Ä¶ */
    // Exemplo atualizado: premia√ß√£o em olimp√≠adas
    premiacao_olimpiadas:{
        nome:"Premia√ß√£o em Olimp√≠adas e/ou Maratonas",
        categoria:"eventos",               // categoria padr√£o
        categoriasAlternativas:["vivencia"],// üëâ pode tamb√©m ser usada em 2c (Viv√™ncia Profissional)
        maxHoras:60,
        comprovacao:"Certificado/declara√ß√£o de premia√ß√£o"
    },
    // ‚Äî restantes das atividades copiadas do arquivo original ‚Äî
    estagio:{nome:"Est√°gio Supervisionado",categoria:"extensao",maxHoras:100,comprovacao:"Plano de est√°gio e relat√≥rio"},
    // ‚Ä¶ copie todas as outras atividades aqui mantendo o mesmo formato ‚Ä¶
};

// Limites por categoria (inalterado)
const limitesCategorias={
    extensao:330,ensino:30,pesquisa:30,vivencia:30,eventos:30,organizacional:30,representacao:30,interdisciplinar:30,outros:20
};
const nomesCategorias={
    extensao:"Extens√£o",ensino:"Ensino",pesquisa:"Pesquisa",vivencia:"Viv√™ncia Profissional",eventos:"Eventos T√©cnicos",organizacional:"Interven√ß√£o Organizacional",representacao:"Representa√ß√£o Estudantil",interdisciplinar:"Forma√ß√£o Interdisciplinar",outros:"Outros"
};

/**********************  ESTADO **********************/
let atividadesRealizadas=[];

/**********************  FUN√á√ïES DE APOIO **********************/
function horasJaRealizadasDoTipo(tipo){
    return atividadesRealizadas.filter(a=>a.tipo===tipo).reduce((s,a)=>s+a.horas,0);
}

function categoriaMaisVazia(opcoes){
    // Calcula qual das categorias em 'opcoes' tem menor propor√ß√£o preenchida
    const horasPorCategoria={};
    Object.keys(limitesCategorias).forEach(cat=>horasPorCategoria[cat]=0);
    atividadesRealizadas.forEach(a=>horasPorCategoria[a.categoria]+=a.horas);
    let melhor=opcoes[0];
    let menorPerc=horasPorCategoria[melhor]/limitesCategorias[melhor];
    for(const cat of opcoes.slice(1)){
        const perc=horasPorCategoria[cat]/limitesCategorias[cat];
        if(perc<menorPerc){menorPerc=perc;melhor=cat;}
    }
    return melhor;
}

/**********************  INICIALIZA√á√ÉO **********************/
function init(){
    populateActivitySelect();
    updateDisplay();
}

function populateActivitySelect(){
    const select=document.getElementById('activityType');
    // Agrupar por categoria prim√°ria
    const grupos={};
    Object.entries(atividades).forEach(([key,at])=>{
        if(!grupos[at.categoria])grupos[at.categoria]=[];
        grupos[at.categoria].push({...at,key});
    });
    Object.keys(grupos).forEach(cat=>{
        const optgroup=document.createElement('optgroup');
        optgroup.label=nomesCategorias[cat];
        grupos[cat].forEach(at=>{
            const option=document.createElement('option');
            option.value=at.key;
            option.textContent=at.nome;
            optgroup.appendChild(option);
        });
        select.appendChild(optgroup);
    });
}

/**********************  HANDLERS **********************/
document.getElementById('activityForm').addEventListener('submit',function(e){
    e.preventDefault();
    const tipo=document.getElementById('activityType').value;
    const horasInput=parseInt(document.getElementById('hours').value);
    const desc=document.getElementById('description').value;
    if(!tipo||!horasInput)return;
    const atividade=atividades[tipo];

    // 1Ô∏è‚É£ Verificar limite do tipo
    const jaFeitas=horasJaRealizadasDoTipo(tipo);
    const restante=atividade.maxHoras-jaFeitas;
    if(restante<=0){
        alert(`Limite m√°ximo (${atividade.maxHoras}h) para \"${atividade.nome}\" j√° atingido.`);
        return;
    }
    const horasParaAdicionar=Math.min(horasInput,restante);
    if(horasParaAdicionar<horasInput){
        alert(`Apenas ${horasParaAdicionar}h podem ser adicionadas. (${atividade.maxHoras}h m√°ximo por atividade).`);
    }

    // 2Ô∏è‚É£ Escolher (ou sugerir) melhor categoria quando houver alternativas
    let categoriaEscolhida=atividade.categoria;
    if(atividade.categoriasAlternativas){
        const opcoes=[atividade.categoria,...atividade.categoriasAlternativas];
        categoriaEscolhida=categoriaMaisVazia(opcoes);
        if(categoriaEscolhida!==atividade.categoria){
            alert(`Sugest√£o: esta atividade pode contar em mais de uma sub‚Äëcategoria. Ela foi alocada em \"${nomesCategorias[categoriaEscolhida]}\" por estar com menos horas.`);
        }
    }

    const novo={id:Date.now(),tipo,nome:atividade.nome,categoria:categoriaEscolhida,horas:horasParaAdicionar,descricao:desc,comprovacao:atividade.comprovacao};
    atividadesRealizadas.push(novo);
    document.getElementById('activityForm').reset();
    updateDisplay();
});

function removeActivity(id){
    atividadesRealizadas=atividadesRealizadas.filter(a=>a.id!==id);
    updateDisplay();
}
function clearAll(){atividadesRealizadas=[];updateDisplay();}

/**********************  UI **********************/
function updateDisplay(){displayActivities();displayProgress();displaySuggestions();}

function displayActivities(){
    const cont=document.getElementById('activities');
    if(!atividadesRealizadas.length){cont.innerHTML='<p style="color:#718096;font-style:italic;">Nenhuma atividade adicionada ainda.</p>';return;}
    cont.innerHTML=atividadesRealizadas.map(a=>`<div class="activity-item"><div class="activity-header"><div class="activity-title">${a.nome}</div><span class="hours-badge">${a.horas}h</span><button class="remove-btn" onclick="removeActivity(${a.id})">√ó</button></div><div style="font-size:.9em;color:#718096;"><strong>Categoria:</strong> ${nomesCategorias[a.categoria]}</div>${a.descricao?`<div style="font-size:.9em;color:#4a5568;margin-top:5px;"><strong>Descri√ß√£o:</strong> ${a.descricao}</div>`:''}<div style="font-size:.85em;color:#a0aec0;margin-top:8px;"><strong>Comprova√ß√£o:</strong> ${a.comprovacao}</div></div>`).join('');
}

function displayProgress(){
    const cont=document.getElementById('progressBars');
    const horasPorCat={};Object.keys(limitesCategorias).forEach(c=>horasPorCat[c]=0);
    atividadesRealizadas.forEach(a=>horasPorCat[a.categoria]+=a.horas);
    const totalExt=horasPorCat.extensao;
    const totalOutras=Object.keys(horasPorCat).filter(c=>c!=='extensao').reduce((s,c)=>s+horasPorCat[c],0);
    const total=totalExt+totalOutras;
    cont.innerHTML=`<div class="category-progress"><div class="category-name">Total Geral: ${total}/430h (${Math.round(total/430*100)}%)</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(total/430*100,100)}%"></div></div></div><div class="category-progress"><div class="category-name">Extens√£o: ${totalExt}/330h (${Math.round(totalExt/330*100)}%)</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(totalExt/330*100,100)}%"></div></div></div><div class="category-progress"><div class="category-name">Outras Atividades: ${totalOutras}/100h (${Math.round(totalOutras/100*100)}%)</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(totalOutras/100*100,100)}%"></div></div></div>`+Object.keys(limitesCategorias).filter(c=>c!=='extensao').map(cat=>{const h=horasPorCat[cat],lim=limitesCategorias[cat],perc=Math.round(h/lim*100);return`<div class="category-progress"><div class="category-name">${nomesCategorias[cat]}: ${h}/${lim}h (${perc}%)</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(perc,100)}%"></div></div></div>`;}).join('');
}

function displaySuggestions(){
    const wrapper=document.getElementById('suggestions');
    const list=document.getElementById('suggestionsList');
    if(!atividadesRealizadas.length){wrapper.style.display='none';return;}
    wrapper.style.display='block';
    const horasPorCat={};Object.keys(limitesCategorias).forEach(c=>horasPorCat[c]=0);
    atividadesRealizadas.forEach(a=>horasPorCat[a.categoria]+=a.horas);
    const totalExt=horasPorCat.extensao;
    const totalOutras=Object.keys(horasPorCat).filter(c=>c!=='extensao').reduce((s,c)=>s+horasPorCat[c],0);
    const sugg=[];
    if(totalExt<330)sugg.push(`Voc√™ ainda precisa de ${330-totalExt}h em <strong>Extens√£o</strong>.`);
    if(totalOutras<100){const catMenos=Object.keys(horasPorCat).filter(c=>c!=='extensao').sort((a,b)=>horasPorCat[a]-horasPorCat[b])[0];sugg.push(`Precisa de mais ${100-totalOutras}h em <strong>Outras Atividades</strong>. Recomendamos focar em <strong>${nomesCategorias[catMenos]}</strong>.`);}
    Object.keys(limitesCategorias).forEach(c=>{if(horasPorCat[c]>limitesCategorias[c]){const exced=horasPorCat[c]-limitesCategorias[c];sugg.push(`‚ö†Ô∏è Limite de <strong>${nomesCategorias[c]}</strong> excedido em ${exced}h.`);}});
    if(totalExt>=330&&totalOutras>=100)sugg.push(`üéâ <strong>Parab√©ns!</strong> Voc√™ j√° completou as 430h necess√°rias!`);
    list.innerHTML=sugg.map(s=>`<div class="suggestion-item">${s}</div>`).join('');
}

// üöÄ start
init();
</script>
</body>
</html>