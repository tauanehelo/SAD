<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Horas Complementares ‚Äì UFBA (v4)</title>
    <style>
        *{margin:0;padding:0;box-sizing:border-box}
        body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh;padding:20px}
        .container{max-width:1200px;margin:0 auto;background:rgba(255,255,255,.95);border-radius:20px;box-shadow:0 20px 40px rgba(0,0,0,.1);overflow:hidden}
        header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:30px;text-align:center}
        h1{font-size:2.5em;margin-bottom:10px;font-weight:300}.subtitle{font-size:1.1em;opacity:.9}
        .main-content{display:grid;grid-template-columns:1fr 1fr;gap:30px;padding:30px}
        .form-section{background:#f8f9ff;padding:25px;border-radius:15px;border-left:5px solid #a8b5ff}
        .results-section{background:#fff5f5;padding:25px;border-radius:15px;border-left:5px solid #ffb3b3}
        h2{color:#5a6acf;margin-bottom:20px;font-size:1.5em}
        .form-group{margin-bottom:20px}
        label{display:block;margin-bottom:8px;color:#4a5568;font-weight:500}
        input,select,textarea{width:100%;padding:12px 15px;border:2px solid #e2e8f0;border-radius:10px;font-size:16px;transition:border-color .3s ease;background:#fff}
        input:focus,select:focus,textarea:focus{outline:none;border-color:#a8b5ff;box-shadow:0 0 0 3px rgba(168,181,255,.1)}
        button{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;border:none;padding:10px 22px;border-radius:25px;font-size:15px;cursor:pointer;transition:transform .2s ease;margin:5px 10px 5px 0}
        button:hover{transform:translateY(-2px);box-shadow:0 5px 15px rgba(102,126,234,.4)}
        .activity-item{background:#fff;padding:15px;margin:10px 0;border-radius:10px;border-left:4px solid #a8b5ff;box-shadow:0 2px 10px rgba(0,0,0,.05)}
        .activity-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
        .activity-title{font-weight:600;color:#2d3748;flex-grow:1}
        .hours-badge{background:#a8b5ff;color:#fff;padding:4px 12px;border-radius:15px;font-size:.85em;font-weight:500}
        .remove-btn{background:#ff6b6b;padding:5px 10px;font-size:12px;margin-left:10px}
        .progress-section{margin-top:30px;padding:20px;background:#f0fff4;border-radius:15px;border-left:5px solid #68d391}
        .progress-bar{background:#e2e8f0;height:20px;border-radius:10px;overflow:hidden;margin:10px 0}
        .progress-fill{height:100%;background:linear-gradient(90deg,#68d391 0%,#38b2ac 100%);transition:width .3s ease;border-radius:10px}
        .category-progress{margin:15px 0}
        .category-name{font-weight:600;color:#2d3748;margin-bottom:5px}
        .suggestions{background:#fffbeb;padding:20px;border-radius:15px;border-left:5px solid #f6ad55;margin-top:20px}
        .suggestion-item{padding:10px;margin:8px 0;background:#fff;border-radius:8px;border-left:3px solid #f6ad55}
        .decision-box{background:#ebf8ff;padding:20px;border-radius:15px;border-left:5px solid #4299e1;margin-top:20px}
        .perfil-box{background:#e6fffa;padding:15px;border-radius:15px;border-left:5px solid #38b2ac;margin-bottom:25px}
        .perfil-option{margin-right:12px;font-size:.95em}
        @media(max-width:768px){.main-content{grid-template-columns:1fr}h1{font-size:2em}}
    </style>
</head>
<body>
<div class="container">
    <header>
        <h1>Sistema de Horas Complementares</h1>
        <p class="subtitle">Ci√™ncia da Computa√ß√£o ‚Äì UFBA</p>
    </header>

    <div class="main-content">
        <div class="form-section">
            <h2>üìù Adicionar Atividade</h2>
            <form id="activityForm">
                <div class="form-group">
                    <label for="activityType">Tipo de Atividade:</label>
                    <select id="activityType" required>
                        <option value="">Selecione uma atividade‚Ä¶</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="hours">Horas Realizadas:</label>
                    <input type="number" id="hours" min="1" required>
                </div>
                <div class="form-group">
                    <label for="description">Descri√ß√£o (opcional):</label>
                    <textarea id="description" rows="3" placeholder="Descreva brevemente a atividade‚Ä¶"></textarea>
                </div>
                <button type="submit">Adicionar Atividade</button>
                <button type="button" onclick="clearAll()">Limpar Tudo</button>
            </form>

            <div class="perfil-box">
                <h3 style="color:#2c7a7b;margin-bottom:8px;">üéØ Meu Perfil</h3>
                <div id="perfilOptions"></div>
            </div>
        </div>
        <div class="results-section">
            <h2>üìä Suas Atividades</h2>
            <div id="activities"></div>
            <div class="suggestions" id="suggestions" style="display:none;">
                <h3>üí° Alertas & Sugest√µes</h3>
                <div id="suggestionsList"></div>
            </div>
            <div id="decisionBox" class="decision-box" style="display:none;"></div>
        </div>
    </div>

    <div class="progress-section">
        <h2>üìà Progresso das Horas Complementares</h2>
        <div id="progressBars"></div>
    </div>
</div>

<script>
/**********************  DEFINI√á√ïES **********************/
const perfisEnum={social:"Social",mercado:"Mercado",academico:"Acad√™mico",geral:"Geral"};

// Atividades (barema completo condensado)
const atividades={
    // Extens√£o (social)
    accs:{nome:"ACCS ‚Äì A√ß√£o Curricular em Comunidade e Sociedade",categoria:"extensao",maxHoras:330,perfil:"social"},
    estagio:{nome:"Est√°gio Supervisionado",categoria:"extensao",maxHoras:100,perfil:"social"},
    programa_extensao:{nome:"Programa de Extens√£o",categoria:"extensao",maxHoras:120,perfil:"social"},
    projeto_extensao:{nome:"Projeto de Extens√£o",categoria:"extensao",maxHoras:120,perfil:"social"},
    curso_extensao:{nome:"Curso/Oficina de Extens√£o (monitor/ministrante)",categoria:"extensao",maxHoras:120,perfil:"social"},
    evento_extensao:{nome:"Evento de Extens√£o (com interven√ß√£o externa)",categoria:"extensao",maxHoras:100,perfil:"social"},
    atividade_campo:{nome:"Atividade de Campo",categoria:"extensao",maxHoras:100,perfil:"social"},
    publicacao_extensao:{nome:"Publica√ß√£o ou Produto de Extens√£o",categoria:"extensao",maxHoras:100,perfil:"social"},
    prest_servico:{nome:"Presta√ß√£o de Servi√ßo √† Comunidade",categoria:"extensao",maxHoras:100,perfil:"social"},
    liga_academica:{nome:"Liga Acad√™mica",categoria:"extensao",maxHoras:120,perfil:"social"},
    empresa_junior:{nome:"Empresa J√∫nior",categoria:"extensao",maxHoras:120,perfil:"mercado"},
    movimento_estudantil_ext:{nome:"Movimento/Coletivo Estudantil (com extens√£o)",categoria:"extensao",maxHoras:120,perfil:"social"},
    open_source_comunidade:{nome:"Open‚Äësource (comunidades externas)",categoria:"extensao",maxHoras:30,perfil:"mercado"},

    // Ensino (acad√™mico)
    monitoria:{nome:"Monitoria",categoria:"ensino",maxHoras:30,perfil:"academico"},
    pet:{nome:"PET ‚Äì Educa√ß√£o Tutorial",categoria:"ensino",maxHoras:30,perfil:"academico"},
    grupo_estudo:{nome:"Grupo de Estudo",categoria:"ensino",maxHoras:30,perfil:"academico"},

    // Pesquisa (acad√™mico)
    iniciacao_cientifica:{nome:"Inicia√ß√£o Cient√≠fica",categoria:"pesquisa",maxHoras:30,perfil:"academico"},
    apresentacao_trabalho:{nome:"Apresenta√ß√£o de Trabalho em Evento",categoria:"pesquisa",maxHoras:30,perfil:"academico"},
    publicacao_periodico:{nome:"Publica√ß√£o em Peri√≥dico",categoria:"pesquisa",maxHoras:30,perfil:"academico"},
    publicacao_conferencia:{nome:"Publica√ß√£o em Confer√™ncia",categoria:"pesquisa",maxHoras:30,perfil:"academico"},
    premiacao_pesquisa:{nome:"Premia√ß√£o em Pesquisa",categoria:"pesquisa",maxHoras:20,perfil:"academico"},

    // Viv√™ncia Profissional (mercado)
    gestao_redes:{nome:"Gest√£o de Redes Acad√™micas",categoria:"vivencia",maxHoras:30,perfil:"mercado"},
    certificacao_tech:{nome:"Certifica√ß√£o Tecnol√≥gica",categoria:"vivencia",maxHoras:30,perfil:"mercado"},
    treinamento_prof:{nome:"Treinamento Profissional",categoria:"vivencia",maxHoras:30,perfil:"mercado"},
    competicao_academica:{nome:"Competi√ß√£o Acad√™mica UFBA",categoria:"vivencia",maxHoras:60,perfil:"mercado"},
    open_source_sti:{nome:"Contribui√ß√£o open‚Äësource STI/UFBA",categoria:"vivencia",maxHoras:30,perfil:"mercado"},

    // Eventos T√©cnicos (social)
    evento_tecnico:{nome:"Congresso/Semin√°rio/Workshop",categoria:"eventos",maxHoras:30,perfil:"social"},
    sociedade_cientifica:{nome:"Associa√ß√£o em Sociedade Cient√≠fica",categoria:"eventos",maxHoras:10,perfil:"academico"},
    premiacao_olimpiadas:{nome:"Premia√ß√£o em Olimp√≠adas/Maratonas",categoria:"eventos",categoriasAlternativas:["vivencia"],maxHoras:30,perfil:"academico"},

    // Interven√ß√£o Organizacional (mercado)
    organizacao_evento:{nome:"Organiza√ß√£o de Evento",categoria:"organizacional",maxHoras:30,perfil:"mercado"},
    ministrante:{nome:"Ministrante de Curso",categoria:"organizacional",maxHoras:30,perfil:"mercado"},
    solucao_tech:{nome:"Desenvolvimento de Solu√ß√£o Tecnol√≥gica",categoria:"organizacional",maxHoras:30,perfil:"mercado"},
    adm_colegiado:{nome:"Atua√ß√£o Administrativa (Colegiado/IC)",categoria:"organizacional",maxHoras:20,perfil:"mercado"},

    // Representa√ß√£o Estudantil (social)
    representacao_discente:{nome:"Representa√ß√£o Discente (CA/DA/DCE)",categoria:"representacao",maxHoras:30,perfil:"social"},
    representacao_unidade:{nome:"Representa√ß√£o em Colegiado/Depart.",categoria:"representacao",maxHoras:30,perfil:"social"},
    comissao_eleitoral:{nome:"Comiss√£o Eleitoral",categoria:"representacao",maxHoras:10,perfil:"social"},
    representacao_sociedade:{nome:"Representa√ß√£o em Sociedade Cient√≠fica",categoria:"representacao",maxHoras:30,perfil:"academico"},

    // Forma√ß√£o Interdisciplinar (geral)
    curso_idioma:{nome:"Curso de Idiomas (n√≠vel interm.+)",categoria:"interdisciplinar",maxHoras:30,perfil:"geral"},
    certificacao_idioma:{nome:"Certifica√ß√£o de Profici√™ncia",categoria:"interdisciplinar",maxHoras:20,perfil:"geral"},
    disciplina_externa:{nome:"Disciplina Fora da Matriz",categoria:"interdisciplinar",maxHoras:30,perfil:"geral"},

    // Outros (geral)
    atividade_fisica:{nome:"Atividades F√≠sicas/Esportivas",categoria:"outros",maxHoras:20,perfil:"geral"},
    atividade_cultural:{nome:"Atividades Culturais",categoria:"outros",maxHoras:20,perfil:"geral"},
    doacao_sangue:{nome:"Doa√ß√£o de Sangue",categoria:"outros",maxHoras:10,perfil:"geral"},
    mesario:{nome:"Mes√°rio (Elei√ß√µes)",categoria:"outros",maxHoras:10,perfil:"geral"}
};

const limitesCategorias={extensao:330,ensino:30,pesquisa:30,vivencia:30,eventos:30,organizacional:30,representacao:30,interdisciplinar:30,outros:20};
const nomesCategorias={extensao:"Extens√£o",ensino:"Ensino",pesquisa:"Pesquisa",vivencia:"Viv√™ncia Profissional",eventos:"Eventos T√©cnicos",organizacional:"Interven√ß√£o Organizacional",representacao:"Representa√ß√£o Estudantil",interdisciplinar:"Forma√ß√£o Interdisciplinar",outros:"Outros"};

/**********************  ESTADO **********************/
let atividadesRealizadas=[];
let pending=null; // escolha pendente para categoria
let alertsMsgs=[]; // mensagens pontuais (ex: limite atingido)
let perfisSelecionados=[];

/**********************  UTILIDADES **********************/
function horasJaRealizadasDoTipo(tipo){return atividadesRealizadas.filter(a=>a.tipo===tipo).reduce((s,a)=>s+a.horas,0);}    

function horasPorCategoria(){const h={};Object.keys(limitesCategorias).forEach(c=>h[c]=0);atividadesRealizadas.forEach(a=>h[a.categoria]+=a.horas);return h;}

/**********************  POPULA√á√ÉO INICIAL **********************/
function createPerfilOptions(){const div=document.getElementById('perfilOptions');Object.entries(perfisEnum).forEach(([k,label])=>{const id="perfil_"+k;const cb=document.createElement('input');cb.type='checkbox';cb.id=id;cb.value=k;cb.addEventListener('change',()=>{if(cb.checked){perfisSelecionados.push(k);}else{perfisSelecionados=perfisSelecionados.filter(p=>p!==k);}displaySuggestions();});const lab=document.createElement('label');lab.htmlFor=id;lab.textContent=label;lab.className='perfil-option';div.appendChild(cb);div.appendChild(lab);});}

function populateActivitySelect(){const sel=document.getElementById('activityType');const grupos={};Object.entries(atividades).forEach(([key,a])=>{if(!grupos[a.categoria])grupos[a.categoria]=[];grupos[a.categoria].push({key,...a});});Object.keys(grupos).forEach(cat=>{const og=document.createElement('optgroup');og.label=nomesCategorias[cat];grupos[cat].sort((x,y)=>x.nome.localeCompare(y.nome)).forEach(at=>{const op=document.createElement('option');op.value=at.key;op.textContent=at.nome;og.appendChild(op);});sel.appendChild(og);});}

/**********************  ALERTAS & DECISION BOX **********************/
function addAlert(msg){alertsMsgs.push(msg);displaySuggestions();}

function orderedOpcoes(opcoes){const h=horasPorCategoria();return [...opcoes].sort((a,b)=>h[a]-h[b]);}

function showDecisionBox(obj){const box=document.getElementById('decisionBox');const opcOrdenadas=orderedOpcoes(obj.opcoes);box.innerHTML=`<h3>üìå Onde alocar esta atividade?</h3><p><strong>${obj.nome}</strong> ‚Äì ${obj.horas}h</p>`+opcOrdenadas.map(c=>`<button onclick="confirmChoice('${c}')">${nomesCategorias[c]}</button>`).join('')+`<button style="background:#ff6b6b" onclick="cancelChoice()">Cancelar</button>`;box.style.display='block';}
function hideDecisionBox(){document.getElementById('decisionBox').style.display='none';}
function confirmChoice(cat){if(!pending)return;addActivity({...pending,categoria:cat});pending=null;hideDecisionBox();}
function cancelChoice(){pending=null;hideDecisionBox();}

/**********************  ATIVIDADES **********************/
function addActivity(a){atividadesRealizadas.push(a);updateDisplay();}
function removeActivity(id){atividadesRealizadas=atividadesRealizadas.filter(x=>x.id!==id);updateDisplay();}
function clearAll(){atividadesRealizadas=[];alertsMsgs=[];updateDisplay();hideDecisionBox();}

/**********************  DISPLAY **********************/
function displayActivities(){const cont=document.getElementById('activities');if(!atividadesRealizadas.length){cont.innerHTML='<p style="color:#718096;font-style:italic;">Nenhuma atividade adicionada ainda.</p>';return;}cont.innerHTML=atividadesRealizadas.map(a=>`<div class="activity-item"><div class="activity-header"><div class="activity-title">${a.nome}</div><span class="hours-badge">${a.horas}h</span><button class="remove-btn" onclick="removeActivity(${a.id})">√ó</button></div><div style="font-size:.9em;color:#718096;"><strong>Categoria:</strong> ${nomesCategorias[a.categoria]}</div>${a.descricao?`<div style="font-size:.9em;color:#4a5568;margin-top:5px;"><strong>Descri√ß√£o:</strong> ${a.descricao}</div>`:''}</div>`).join('');}

function displayProgress(){const cont=document.getElementById('progressBars');const h=horasPorCategoria();const total=Object.values(h).reduce((s,x)=>s+x,0);cont.innerHTML=`<div class="category-progress"><div class="category-name">Total Geral: ${total}/430h (${Math.round(total/430*100)}%)</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(total/430*100,100)}%"></div></div></div>`+Object.keys(limitesCategorias).map(cat=>{const perc=Math.round(h[cat]/limitesCategorias[cat]*100);return`<div class="category-progress"><div class="category-name">${nomesCategorias[cat]}: ${h[cat]}/${limitesCategorias[cat]}h (${perc}%)</div><div class="progress-bar"><div class="progress-fill" style="width:${Math.min(perc,100)}%"></div></div></div>`;}).join('');}

function displaySuggestions(){const wrap=document.getElementById('suggestions');const list=document.getElementById('suggestionsList');if(!atividadesRealizadas.length && !alertsMsgs.length){wrap.style.display='none';return;}wrap.style.display='block';const h=horasPorCategoria();let msgs=[...alertsMsgs]; // copy alerts
// Limite excedido
Object.keys(limitesCategorias).forEach(c=>{if(h[c]>limitesCategorias[c])msgs.push(`‚ö†Ô∏è Excedeu o limite de <strong>${nomesCategorias[c]}</strong> em ${h[c]-limitesCategorias[c]}h.`);});
// Recomenda√ß√µes de atividades por perfil
if(perfisSelecionados.length){const recomendaveis=Object.entries(atividades).filter(([key,a])=>perfisSelecionados.includes(a.perfil)&& horasJaRealizadasDoTipo(key)<a.maxHoras);
recomendaveis.sort(([,a],[,b])=>horasJaRealizadasDoTipo(a.nome)-horasJaRealizadasDoTipo(b.nome));
const top=recomendaveis.slice(0,5).map(([,a])=>`‚Ä¢ ${a.nome} (${nomesCategorias[a.category||a.categoria]})`);
if(top.length)msgs.push(`<strong>Ideias para seu perfil:</strong><br>${top.join('<br>')}`);
}
list.innerHTML=msgs.map(m=>`<div class="suggestion-item">${m}</div>`).join('');alertsMsgs=[];}

function updateDisplay(){displayActivities();displayProgress();displaySuggestions();}

/**********************  FORM HANDLER **********************/
document.getElementById('activityForm').addEventListener('submit',e=>{
    e.preventDefault();
    const tipo=document.getElementById('activityType').value;if(!tipo)return;
    const horasInput=parseInt(document.getElementById('hours').value);if(!horasInput)return;
    const desc=document.getElementById('description').value;
    const at=atividades[tipo];

    const ja=horasJaRealizadasDoTipo(tipo);
    const restante=at.maxHoras - ja;
    if (restante <= 0) {
        addAlert(`Limite de ${at.maxHoras}h para ‚Äú${at.nome}‚Äù j√° atingido.`);
        return;
    }

    const horasAdd = Math.min(horasInput, restante);
    if (horasAdd < horasInput) {
        addAlert(`S√≥ √© poss√≠vel adicionar ${horasAdd}h (m√°ximo por atividade).`);
    }

    const opcoes = at.categoriasAlternativas ? [at.categoria, ...at.categoriasAlternativas] : [at.categoria];
    const baseObj = {
        id: Date.now(),
        tipo,
        nome: at.nome,
        horas: horasAdd,
        descricao: desc,
        comprovacao: at.comprovacao,
        opcoes
    };

    if (opcoes.length > 1) {
        pending = baseObj;
        showDecisionBox({ ...baseObj });
    } else {
        addActivity({ ...baseObj, categoria: at.categoria });
    }

    document.getElementById('activityForm').reset();
});

// üöÄ Inicializa√ß√£o
window.onload = () => {
    populateActivitySelect();
    createPerfilOptions();
    updateDisplay();
};
</script>
</body>
</html>
