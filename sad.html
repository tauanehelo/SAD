<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Horas Complementares ‚Äì UFBA (v4.4)</title>
  <style>
    /* ===== RESET & BASE ===== */
    *{margin:0;padding:0;box-sizing:border-box;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif}
    body{background:linear-gradient(135deg,#f5f7fa 0%,#c3cfe2 100%);min-height:100vh;padding:20px;color:#1a202c}
    h1,h2,h3{font-weight:300}
    /* ===== LAYOUT ===== */
    .container{max-width:1200px;margin:0 auto;background:#fff;border-radius:20px;box-shadow:0 25px 55px rgba(0,0,0,.08);overflow:hidden}
    header{background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);color:#fff;padding:34px 20px;text-align:center}
    header h1{font-size:2.3em;margin-bottom:4px}
    .main{display:grid;grid-template-columns:1fr 1fr;gap:32px;padding:28px}
    @media(max-width:860px){.main{grid-template-columns:1fr}}
    .panel{padding:24px;border-radius:18px}
    .form-panel{background:#f8faff;border-left:6px solid #8c97ff}
    .list-panel{background:#fff5f5;border-left:6px solid #ffb3b3}
    .progress-panel{background:#f0fff4;border-left:6px solid #48bb78;padding:26px 30px}
    /* ===== WIDGETS / ELEMENTS ===== */
    h2{color:#5661d1;font-size:1.45em;margin-bottom:16px}
    .form-group{margin-bottom:16px}
    label{display:block;font-weight:600;margin-bottom:6px;color:#4a5568}
    select,input,textarea{width:100%;padding:10px 14px;border:2px solid #e2e8f0;border-radius:10px;font-size:15px;background:#fff;transition:border-color .25s}
    select:focus,input:focus,textarea:focus{outline:none;border-color:#8c97ff;box-shadow:0 0 0 3px rgba(140,151,255,.15)}
    button{border:none;padding:8px 20px;font-size:15px;border-radius:25px;margin:4px 10px 0 0;cursor:pointer;transition:transform .2s;color:#fff;background:linear-gradient(135deg,#667eea 0%,#764ba2 100%)}
    button:hover{transform:translateY(-2px);box-shadow:0 4px 12px rgba(102,126,234,.35)}
    .btn-danger{background:#ff6060}
    /* ===== ACTIVITY CARD ===== */
    .activity-card,.legend-card{background:#fff;border-left:4px solid #8c97ff;box-shadow:0 3px 10px rgba(0,0,0,.05);border-radius:12px;padding:14px;margin:9px 0}
    .activity-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px}
    .activity-title{font-weight:600;font-size:.95em;color:#2d3748;flex:1}
    .badge{background:#8c97ff;color:#fff;border-radius:14px;padding:3px 10px;font-size:.78em;font-weight:500}
    .remove-btn{padding:3px 9px;border-radius:12px;margin-left:10px;font-size:.8em}
    .legend-card{border-left-color:#a0aec0}
    /* ===== PROGRESS ===== */
    .progress-row{margin:12px 0}
    .progress-label{font-size:.9em;font-weight:600;margin-bottom:4px;color:#2d3748}
    .bar-bg{background:#e2e8f0;height:18px;border-radius:10px;overflow:hidden}
    .bar-fill{height:100%;background:linear-gradient(90deg,#48bb78 0%,#38b2ac 100%);border-radius:10px;transition:width .35s}
    /* ===== OTHER BOXES ===== */
    .suggestions{margin-top:20px;background:#fffdf4;border-left:6px solid #f6ad55;border-radius:15px;padding:18px}
    .suggestion-item{margin:6px 0;padding:8px;background:#fff;border-left:3px solid #f6ad55;border-radius:8px;font-size:.9em}
    .decision-box{margin-top:20px;background:#ebf8ff;border-left:6px solid #4299e1;border-radius:15px;padding:18px}
    .perfil-box{background:#e6fffa;border-left:6px solid #38b2ac;border-radius:15px;padding:14px;margin-top:20px}
    .perfil-option{margin-right:12px;font-size:.9em}
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1>Sistema de Horas Complementares</h1>
      <p>Ci√™ncia da Computa√ß√£o ‚Äì UFBA</p>
    </header>
    <div class="main">
      <!-- ========= FORM ========= -->
      <section class="panel form-panel">
        <h2>üìù Adicionar Atividade</h2>
        <form id="activityForm">
          <div class="form-group">
            <label for="activityType">Tipo de Atividade:</label>
            <select id="activityType" required><option value="">Selecione‚Ä¶</option></select>
          </div>
          <div class="form-group">
            <label for="hours">Horas Realizadas:</label>
            <input id="hours" type="number" min="1" required>
          </div>
          <div class="form-group">
            <label for="description">Descri√ß√£o (opcional):</label>
            <textarea id="description" rows="3"></textarea>
          </div>
          <button type="submit">Adicionar</button><button type="button" class="btn-danger" onclick="clearAll()">Limpar Tudo</button>
        </form>
        <div class="perfil-box">
          <h3 style="margin-bottom:6px;color:#256d6a">üéØ Meu Perfil</h3>
          <div id="perfilOptions"></div>
        </div>
      </section>
      <!-- ========= LISTA ========= -->
      <section class="panel list-panel">
        <h2>üìä Suas Atividades</h2>
        <div id="activities"></div>
        <div class="suggestions" id="suggestions" style="display:none;">
          <h3>üí° Alertas & Sugest√µes</h3>
          <div id="suggestionsList"></div>
        </div>
        <div id="decisionBox" class="decision-box" style="display:none;"></div>
      </section>
    </div>
    <!-- ========= PROGRESS ========= -->
    <section class="progress-panel">
      <h2>üìà Progresso das Horas Complementares</h2>
      <div id="progressBars"></div>
      <div id="legendBox"></div>
    </section>
  </div>

<script>
/*********************** CONSTANTES ***********************/
const LIMITE_OUTRAS=100;
const perfisEnum={social:'Social',mercado:'Mercado',academico:'Acad√™mico',geral:'Geral'};

// ======= Atividades (mais criterioso, sem mesclar incongruentes) =======
const atividades={
  // Extens√£o
  accs:{nome:'ACCS ‚Äì A√ß√£o Curricular em Comunidade e Sociedade',categoria:'extensao',maxHoras:330,perfil:'social',comprovacao:'Comprovante de carga hor√°ria'},
  estagio:{nome:'Est√°gio Supervisionado',categoria:'extensao',maxHoras:100,perfil:'mercado',comprovacao:'Plano de est√°gio + relat√≥rio'},
  programa_ext:{nome:'Programa de Extens√£o',categoria:'extensao',maxHoras:120,perfil:'social',comprovacao:'Relat√≥rio SIATEX'},
  projeto_ext:{nome:'Projeto de Extens√£o',categoria:'extensao',maxHoras:120,perfil:'social',comprovacao:'Relat√≥rio SIATEX'},
  empresa_junior:{nome:'Empresa J√∫nior',categoria:'extensao',maxHoras:120,perfil:'mercado',comprovacao:'Certificado de participa√ß√£o'},
  oss_comunidade:{nome:'Contribui√ß√£o OSS (Comunidade)',categoria:'extensao',maxHoras:30,perfil:'mercado',comprovacao:'Link de commit/merge aprovado'},

  // Ensino
  monitoria:{nome:'Monitoria',categoria:'ensino',maxHoras:30,perfil:'academico',comprovacao:'Certificado ‚â•20h'},
  pet:{nome:'PET ‚Äì Educa√ß√£o Tutorial',categoria:'ensino',maxHoras:30,perfil:'academico',comprovacao:'Certificado ‚â•20h'},
  grupo_estudo:{nome:'Grupo de Estudo',categoria:'ensino',maxHoras:30,perfil:'academico',comprovacao:'Certificado ‚â•20h'},

  // Pesquisa
  iniciacao_cient:{nome:'Inicia√ß√£o Cient√≠fica',categoria:'pesquisa',maxHoras:30,perfil:'academico',comprovacao:'Relat√≥rio/Certificado'},
  artigo_periodico:{nome:'Publica√ß√£o em Peri√≥dico',categoria:'pesquisa',maxHoras:30,perfil:'academico',comprovacao:'Artigo publicado'},
  artigo_conferencia:{nome:'Publica√ß√£o em Confer√™ncia',categoria:'pesquisa',maxHoras:30,perfil:'academico',comprovacao:'Artigo publicado'},

  // Viv√™ncia Profissional
  treinamento_prof:{nome:'Treinamento Profissional',categoria:'vivencia',maxHoras:30,perfil:'mercado',comprovacao:'Certificado'},
  certificacao_tech:{nome:'Certifica√ß√£o Tecnol√≥gica',categoria:'vivencia',maxHoras:30,perfil:'mercado',comprovacao:'Certificado'},
  gestao_redes:{nome:'Gest√£o de Redes Acad√™micas',categoria:'vivencia',maxHoras:30,perfil:'mercado',comprovacao:'Declara√ß√£o docente'},

  // Eventos T√©cnicos
  congresso:{nome:'Congresso / Workshop',categoria:'eventos',maxHoras:30,perfil:'academico',comprovacao:'Certificado'},
  premiacao_olimp:{nome:'Premia√ß√£o em Olimp√≠adas/Maratonas',categoria:'eventos',categoriasAlternativas:['vivencia'],maxHoras:30,perfil:'academico',comprovacao:'Certificado de premia√ß√£o'},

  // Organizacional
  org_evento:{nome:'Organiza√ß√£o de Evento',categoria:'organizacional',maxHoras:30,perfil:'mercado',comprovacao:'Declara√ß√£o comiss√£o'},
  solucao_tech:{nome:'Desenvolvimento de Solu√ß√£o Tecnol√≥gica',categoria:'organizacional',maxHoras:30,perfil:'mercado',comprovacao:'Relat√≥rio / registro'},

  // Representa√ß√£o
  rep_discente:{nome:'Representa√ß√£o Discente (CA/DCE)',categoria:'representacao',maxHoras:30,perfil:'social',comprovacao:'Ata + declara√ß√£o'},
  rep_sociedade:{nome:'Representa√ß√£o em Sociedade Cient√≠fica',categoria:'representacao',maxHoras:30,perfil:'academico',comprovacao:'Declara√ß√£o da sociedade'},

  // Interdisciplinar
  curso_idioma:{nome:'Curso de Idiomas',categoria:'interdisciplinar',maxHoras:30,perfil:'geral',comprovacao:'Certificado'},
  certificacao_idioma:{nome:'Certifica√ß√£o de Profici√™ncia',categoria:'interdisciplinar',maxHoras:20,perfil:'geral',comprovacao:'Certificado'},

  // Outros
  atividade_fisica:{nome:'Atividade F√≠sica / Esportiva',categoria:'outros',maxHoras:20,perfil:'geral',comprovacao:'Certificado'},
  atividade_cultural:{nome:'Atividade Cultural',categoria:'outros',maxHoras:20,perfil:'geral',comprovacao:'Certificado'}
};

const limitesCat={extensao:330,ensino:30,pesquisa:30,vivencia:30,eventos:30,organizacional:30,representacao:30,interdisciplinar:30,outros:20};
const nomesCat={extensao:'Extens√£o',ensino:'Ensino',pesquisa:'Pesquisa',vivencia:'Viv√™ncia Profissional',eventos:'Eventos T√©cnicos',organizacional:'Interven√ß√£o Organizacional',representacao:'Representa√ß√£o Estudantil',interdisciplinar:'Forma√ß√£o Interdisciplinar',outros:'Outros'};

/*********************** STATE ***********************/
let registros=[];let pendente=null;let perfisMarcados=[];let alertaStack=[];

/*********************** HELPERS ***********************/
const somaCat=()=>{const h={};Object.keys(limitesCat).forEach(c=>h[c]=0);registros.forEach(r=>h[r.categoria]+=r.horas);return h;};
const horasTipo=t=>registros.filter(r=>r.tipo===t).reduce((s,r)=>s+r.horas,0);

/*********************** BUILD UI ***********************/
function montarSelect(){const sel=document.getElementById('activityType');const grupos={};Object.entries(atividades).forEach(([k,a])=>{if(!grupos[a.categoria])grupos[a.categoria]=[];grupos[a.categoria].push({key:k,...a});});Object.keys(grupos).forEach(cat=>{const og=document.createElement('optgroup');og.label=nomesCat[cat];grupos[cat].sort((x,y)=>x.nome.localeCompare(y.nome)).forEach(a=>{const op=document.createElement('option');op.value=a.key;op.textContent=a.nome;og.appendChild(op);});sel.appendChild(og);});}
function montarPerfis(){const box=document.getElementById('perfilOptions');Object.entries(perfisEnum).forEach(([k,lab])=>{const id='p_'+k;const cb=document.createElement('input');cb.type='checkbox';cb.id=id;cb.value=k;cb.addEventListener('change',()=>{cb.checked?perfisMarcados.push(k):perfisMarcados=perfisMarcados.filter(p=>p!==k);atualizarSugestoes();});const lb=document.createElement('label');lb.textContent=lab;lb.htmlFor=id;lb.className='perfil-option';box.appendChild(cb);box.appendChild(lb);});}
function montarLegenda(){const div=document.getElementById('legendBox');div.innerHTML='<h3 style="font-weight:600;margin-bottom:8px">üìÑ Legenda de Comprovantes</h3>'+Object.values(atividades).map(a=>`<div class="legend-card"><div class="activity-header"><span class="activity-title">${a.nome}</span></div><div style="font-size:.82em;color:#4a5568"><strong>Categoria:</strong> ${nomesCat[a.categoria]}</div><div style="font-size:.8em;color:#555"><strong>Comprova√ß√£o:</strong> ${a.comprovacao}</div></div>`).join('');}

/*********************** RENDER FUNCTIONS ***********************/
function renderAtividades(){const c=document.getElementById('activities');if(!registros.length){c.innerHTML='<p style="color:#718096;font-style:italic;">Nenhuma atividade adicionada.</p>';return;}c.innerHTML=registros.map(a=>`<div class="activity-card"><div class="activity-header"><span class="activity-title">${a.nome}</span><span class="badge">${a.horas}h</span><button class="remove-btn btn-danger" onclick="remover(${a.id})">√ó</button></div><div style="font-size:.82em;color:#4a5568"><strong>Categoria:</strong> ${nomesCat[a.categoria]}</div><div style="font-size:.8em;color:#555"><strong>Comprova√ß√£o:</strong> ${a.comprovacao}</div>${a.descricao?`<div style="font-size:.8em;color:#4a5568;margin-top:4px"><strong>Descri√ß√£o:</strong> ${a.descricao}</div>`:''}</div>`).join('');}
function renderProgresso(){const h=somaCat();const total=Object.values(h).reduce((s,v)=>s+v,0);const cont=document.getElementById('progressBars');cont.innerHTML=`<div class="progress-row"><div class="progress-label">Total Geral: ${total}/430h (${Math.round(total/430*100)}%)</div><div class="bar-bg"><div class="bar-fill" style="width:${Math.min(total/430*100,100)}%"></div></div></div>`+Object.keys(limitesCat).map(cat=>{const perc=Math.round(h[cat]/limitesCat[cat]*100);return`<div class="progress-row"><div class="progress-label">${nomesCat[cat]}: ${h[cat]}/${limitesCat[cat]}h (${perc}%)</div><div class="bar-bg"><div class="bar-fill" style="width:${Math.min(perc,100)}%"></div></div></div>`}).join('');}
function atualizarSugestoes(){const w=document.getElementById('suggestions');const l=document.getElementById('suggestionsList');const msgs=[...alertaStack];alertaStack.length=0;const h=somaCat();Object.keys(h).forEach(c=>{if(h[c]>limitesCat[c])msgs.push(`‚ö†Ô∏è Excedeu <strong>${nomesCat[c]}</strong> em ${h[c]-limitesCat[c]}h.`);});const outras=Object.keys(h).filter(c=>c!=='extensao').reduce((s,c)=>s+h[c],0);if(outras>=LIMITE_OUTRAS)msgs.push('üîí Limite de 100h da Categoria 2. Apenas Extens√£o √© v√°lida.');if(perfisMarcados.length){const candidatos=Object.entries(atividades).filter(([k,a])=>perfisMarcados.includes(a.perfil)&&horasTipo(k)<a.maxHoras&&(a.categoria==='extensao'||outras<LIMITE_OUTRAS));candidatos.sort(([,a],[,b])=>horasTipo(a.key)-horasTipo(b.key));const top=candidatos.slice(0,6).map(([,a])=>`‚Ä¢ ${a.nome} ‚Äì at√© ${a.maxHoras-horasTipo(a.key)}h`);if(top.length)msgs.push('<strong>Sugest√µes para seu perfil:</strong><br>'+top.join('<br>'));}w.style.display=msgs.length?'block':'none';l.innerHTML=msgs.map(m=>`<div class="suggestion-item">${m}</div>`).join('');}
function drawAll(){renderAtividades();renderProgresso();atualizarSugestoes();}

/*********************** DECISION BOX ***********************/
function abrirDecisao(obj){const h=somaCat();const opts=[...obj.opcoes].sort((a,b)=>h[a]-h[b]);const box=document.getElementById('decisionBox');box.innerHTML=`<strong>Alocar "${obj.nome}" (${obj.horas}h):</strong><br>`+opts.map(c=>`<button onclick="pick('${c}')">${nomesCat[c]}</button>`).join(' ')+' <button class="btn-danger" onclick="fecharDecisao()">Cancelar</button>';box.style.display='block';}
function fecharDecisao(){document.getElementById('decisionBox').style.display='none';}
function pick(cat){if(pendente){inserir({...pendente,categoria:cat});pendente=null;}fecharDecisao();}

/*********************** CRUD ***********************/
function inserir(r){registros.push(r);drawAll();}
function remover(id){registros=registros.filter(x=>x.id!==id);drawAll();}
function clearAll(){registros=[];alertaStack=[];drawAll();fecharDecisao();}

/*********************** FORM SUBMIT ***********************/
document.getElementById('activityForm').addEventListener('submit',e=>{e.preventDefault();const tipo=document.getElementById('activityType').value;const horas=parseInt(document.getElementById('hours').value);const desc=document.getElementById('description').value.trim();if(!tipo||!horas)return;const at=atividades[tipo];const jaTipo=horasTipo(tipo);if(jaTipo>=at.maxHoras){alertaStack.push(`Limite de ${at.maxHoras}h para "${at.nome}" atingido.`);drawAll();return;}const horasAdd=Math.min(horas,at.maxHoras-jaTipo);if(horasAdd<horas)alertaStack.push(`Apenas ${horasAdd}h adicionadas (limite da atividade).`);const h=somaCat();const outras=Object.keys(h).filter(c=>c!=='extensao').reduce((s,c)=>s+h[c],0);if(at.categoria!=='extensao'&&outras>=LIMITE_OUTRAS){alertaStack.push('Categoria 2 em 100h. Insira apenas Extens√£o.');drawAll();return;}if(at.categoria!=='extensao'&&outras+horasAdd>LIMITE_OUTRAS){alertaStack.push(`Restam apenas ${LIMITE_OUTRAS-outras}h na Categoria 2.`);drawAll();return;}const opcoes=at.categoriasAlternativas?[at.categoria,...at.categoriasAlternativas]:[at.categoria];const base={id:Date.now(),tipo,nome:at.nome,horas:horasAdd,descricao:desc,comprovacao:at.comprovacao,opcoes};if(opcoes.length>1){pendente=base;abrirDecisao(base);}else{inserir({...base,categoria:at.categoria});}e.target.reset();});

/*********************** INIT ***********************/
window.addEventListener('DOMContentLoaded',()=>{montarSelect();montarPerfis();montarLegenda();drawAll();});
</script>
</body>
</html>
